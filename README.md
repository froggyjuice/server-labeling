# 🏷️ 라벨링 시스템

신생아 주요 질환 X-ray 소견 라벨링을 위한 웹 애플리케이션입니다. 질환 중복선택이 가능하며, 전문의가 X-ray 영상에서만 파악 가능한 특징적인 소견을 중심으로 신생아 주요 질환을 분류할 수 있습니다.

## 🚀 시작하기

### 1. 애플리케이션 실행
```bash
python main.py
```
- 웹 서버가 `http://localhost:5001`에서 실행됩니다
- 브라우저에서 접속하여 사용할 수 있습니다

### 2. 파일 업로드 (관리자용)

파일을 데이터베이스에 업로드하려면 통합 데이터베이스 관리 도구를 사용합니다:

```bash
python database_manager.py
```

메뉴에서 "3. 폴더에서 파일 업로드"를 선택하고 폴더 경로를 입력하세요.

**지원되는 파일 형식:**
- 텍스트 파일: `.txt`
- 이미지 파일: `.jpg`, `.jpeg`, `.png`
- DICOM 파일: `.dcm` (자동으로 PNG로 변환)

## 👥 사용자 관리

### 기본 계정
- **관리자**: `admin` / `password123`
- **새 사용자**: 웹에서 회원가입 가능

### 사용자 기능
1. **회원가입/로그인**: 웹 인터페이스에서 가능
2. **파일 라벨링**: 좋아요(👍) / 싫어요(👎) 버튼으로 라벨링
3. **파일 보기**: 텍스트 파일은 내용 확인, 이미지는 썸네일 및 전체 크기 보기
4. **통계 확인**: 전체 라벨링 통계 및 개인 라벨링 통계

## 📊 라벨링 시스템

### 질환 중복선택 기능 ✨
- **다중 질환 선택**: 하나의 X-ray 이미지에 여러 질환을 동시에 선택할 수 있습니다
- **체크박스 인터페이스**: 직관적인 체크박스로 질환을 선택할 수 있습니다
- **실시간 소견 업데이트**: 선택한 질환에 따라 관련 소견들이 자동으로 표시됩니다

### 지원하는 질환
1. **신생아 호흡 곤란 증후군 (RDS)**
2. **기관지폐이형성증 (BPD)**
3. **기흉 (Pneumothorax)**
4. **폐간질성 기종 (PIE)**
5. **종격동 기종 (Pneumomediastinum)**
6. **피하 기종 (Subcutaneous Emphysema)**
7. **심장막 기종 (Pneumopericardium)**
8. **괴사성 장염 (NEC)**

### 라벨링 방법
1. 로그인 후 대시보드에서 파일 목록 확인
2. "라벨링" 버튼을 클릭하여 라벨링 모달 열기
3. 질환을 체크박스로 선택 (복수 선택 가능)
4. 사진 종류 선택 (AP, LATDEQ, LAT, PA)
5. 관련 소견들을 체크박스로 선택
6. "라벨링 저장" 버튼으로 저장

### 통계 정보
- **총 파일 수**: 데이터베이스에 등록된 파일 수
- **내 라벨링 수**: 현재 사용자가 라벨링한 파일 수
- **질환별 통계**: 각 질환별 라벨링 통계
- **사진 종류별 통계**: AP, LATDEQ, LAT, PA별 통계

## 🛠️ 관리자 도구

### 통합 데이터베이스 관리 도구
```bash
# 통합 데이터베이스 관리 도구 실행
python database_manager.py
```

**주요 기능:**
- 📊 모든 사용자/파일 조회
- 📁 폴더에서 파일 일괄 업로드 (DICOM 변환 포함)
- 💾 데이터베이스 백업/복원
- 🔍 데이터베이스 무결성 검증
- 📈 Excel로 데이터 내보내기
- 🗂️ SQLite 뷰어 (GUI)
- 🗑️ 파일 삭제 (단일/다중)

### 메뉴 옵션
1. **모든 사용자 조회**: 등록된 사용자 목록 확인
2. **모든 파일 조회**: 업로드된 파일 목록 확인
3. **폴더에서 파일 업로드**: 지정 폴더의 파일들을 일괄 업로드
4. **데이터베이스 백업**: 현재 상태 백업
5. **백업 목록 조회**: 생성된 백업 파일 목록
6. **백업에서 복원**: 선택한 백업으로 복원
7. **무결성 검증**: 데이터베이스 구조 검증
8. **Excel로 전체 데이터 내보내기**: 모든 데이터를 Excel로 내보내기
9. **Excel로 선택 데이터 내보내기**: 특정 데이터만 Excel로 내보내기
10. **SQLite 뷰어 열기**: GUI로 데이터베이스 확인
11. **파일 삭제**: 파일 ID, 파일명, 또는 다중 파일 삭제
12. **종료**: 프로그램 종료

## 📁 프로젝트 구조

```
0705/
├── main.py                    # 메인 Flask 애플리케이션
├── user.py                    # 데이터베이스 모델
├── database_manager.py        # 통합 데이터베이스 관리 도구
├── migrate_disease_to_json.py # 질환 데이터 마이그레이션 스크립트
├── static/                    # 정적 파일 (HTML, CSS, JS)
├── uploads/                   # 업로드된 파일 저장소
└── database/                  # SQLite 데이터베이스
    ├── app.db                # 메인 데이터베이스
    └── backups/              # 백업 파일들
```

## 🔄 데이터 마이그레이션

### 질환 중복선택 기능 업그레이드
기존 단일 질환 데이터를 새로운 JSON 배열 형태로 변환하려면:

```bash
python migrate_disease_to_json.py
```

이 스크립트는:
- 기존 데이터베이스를 자동으로 백업
- 단일 질환 데이터를 JSON 배열 형태로 변환
- 마이그레이션 결과를 상세히 보고
- 안전하게 데이터를 보호

## 🔧 기술 스택

- **백엔드**: Flask (Python)
- **데이터베이스**: SQLite + SQLAlchemy
- **프론트엔드**: HTML, CSS, JavaScript
- **파일 처리**: 텍스트 파일, 이미지 파일 (JPG, PNG), DICOM 파일
- **데이터 관리**: pandas, openpyxl (Excel 내보내기)

## 📝 주요 기능

### 사용자 기능
- ✅ 회원가입/로그인
- ✅ 파일 목록 조회
- ✅ 텍스트 파일 내용 보기
- ✅ 이미지 파일 썸네일 및 전체 크기 보기
- ✅ 좋아요/싫어요 라벨링
- ✅ 실시간 라벨링 통계
- ✅ 개인 라벨링 기록

### 관리자 기능
- ✅ 통합 데이터베이스 관리 도구
- ✅ 파일 일괄 업로드 (DICOM 변환 포함)
- ✅ 데이터베이스 백업/복원
- ✅ Excel 데이터 내보내기
- ✅ GUI 데이터베이스 뷰어
- ✅ 파일 삭제 (단일/다중)
- ✅ 데이터 무결성 검증

## 🎯 사용 시나리오

1. **관리자가 파일 업로드**
   ```bash
   python database_manager.py
   # 메뉴에서 "3. 폴더에서 파일 업로드" 선택
   # 폴더 경로 입력: ./my_data_files
   ```

2. **사용자들이 라벨링**
   - 웹에서 로그인
   - 파일 목록에서 좋아요/싫어요 클릭
   - 실시간으로 라벨링 결과 확인

3. **결과 확인 및 관리**
   ```bash
   python database_manager.py
   # 메뉴에서 원하는 기능 선택
   # - 모든 사용자/파일 조회
   # - Excel로 데이터 내보내기
   # - SQLite 뷰어로 상세 확인
   ```

## 🔒 보안 및 권한

- **일반 사용자**: 라벨링만 가능
- **관리자**: 파일 업로드 및 시스템 관리
- **세션 기반 인증**: 로그인 상태 유지
- **파일 접근 제한**: 업로드된 파일만 접근 가능

## 📋 데이터베이스 관리 팁

### 백업 관리
- 정기적으로 백업을 생성하여 데이터 보호
- 백업 파일은 `database/backups/` 폴더에 저장
- 복원 시 기존 데이터가 덮어쓰이므로 주의

### 파일 업로드
- DICOM 파일은 자동으로 PNG로 변환되어 저장
- 중복 파일은 자동으로 건너뜀
- 폴더 구조가 파일명에 반영됨

### 데이터 내보내기
- 전체 데이터 또는 선택 데이터를 Excel로 내보내기 가능
- 사용자, 파일, 라벨 데이터를 각각 별도 시트로 저장 